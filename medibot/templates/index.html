<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Medical Chatbot - HealthAssist</title>
    
    <!-- Bootstrap CSS with Replit Theme -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar d-none d-md-block">
                <div class="p-4">
                    <div class="d-flex align-items-center mb-5">
                        <div class="d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border-radius: 12px; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);">
                            <i class="fas fa-heartbeat text-white fs-5"></i>
                        </div>
                        <div>
                            <h5 class="mb-0 text-white fw-bold">HealthAssist</h5>
                            <small class="text-muted">AI Medical Assistant</small>
                        </div>
                    </div>
                    
                    <!-- Current Plan Display -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-crown me-2 text-warning"></i>
                                    Current Plan
                                </h6>
                                <span class="badge bg-info" id="current-plan-badge">{{ user_plan.title() }}</span>
                            </div>
                            {% if user_plan == 'basic' %}
                            <div class="text-muted small">
                                <i class="fas fa-info-circle me-1"></i>
                                Limited features - Upgrade for more
                            </div>
                            {% elif user_plan == 'pro' %}
                            <div class="text-success small">
                                <i class="fas fa-check-circle me-1"></i>
                                Enhanced features active
                                <span class="voice-feature-badge ms-2" title="Voice chat enabled">
                                    <i class="fas fa-microphone"></i> Voice
                                </span>
                            </div>
                            {% elif user_plan == 'deluxe' %}
                            <div class="text-warning small">
                                <i class="fas fa-star me-1"></i>
                                Premium features unlocked
                                <span class="voice-feature-badge ms-2" title="Voice chat enabled">
                                    <i class="fas fa-microphone"></i> Voice
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Plan Selection -->
                    <div class="card mb-3">
                        <div class="card-body p-3">
                            <h6 class="card-title">Switch Plan (Demo)</h6>
                            <select class="form-select" id="plan-selector">
                                {% for plan_key, plan_data in plans.items() %}
                                <option value="{{ plan_key }}" {% if plan_key == user_plan %}selected{% endif %}>
                                    {{ plan_data.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <!-- Language Selection -->
                    <div class="card mb-3">
                        <div class="card-body p-3">
                            <h6 class="card-title">
                                <i class="fas fa-globe me-1"></i>
                                Language
                            </h6>
                            <div class="mb-2">
                                <small class="text-muted">Current:</small>
                                <span class="badge bg-secondary ms-1" id="current-language-display">
                                    {{ languages[user_language].flag if user_language in languages else 'ðŸ‡ºðŸ‡¸' }} 
                                    {{ languages[user_language].name if user_language in languages else 'English' }}
                                </span>
                            </div>
                            <select class="form-select" id="language-selector" data-current="{{ user_language }}">
                                {% for lang_code in available_languages %}
                                    {% if lang_code in languages %}
                                    <option value="{{ lang_code }}" {% if lang_code == user_language %}selected{% endif %}>
                                        {{ languages[lang_code].flag }} {{ languages[lang_code].name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <small class="text-muted mt-1 d-block">
                                Available: {{ available_languages|length }} language{{ 's' if available_languages|length != 1 else '' }}
                            </small>
                        </div>
                    </div>
                    
                    <!-- Usage Stats -->
                    <div class="card mb-3">
                        <div class="card-body p-3">
                            <h6 class="card-title">Daily Usage</h6>
                            <div id="usage-stats">
                                <div class="d-flex justify-content-between">
                                    <span>Used:</span>
                                    <span id="usage-count">0</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Limit:</span>
                                    <span id="usage-limit">2</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Controls -->
                    <div class="card">
                        <div class="card-body p-3">
                            <h6 class="card-title">
                                <i class="fas fa-comments me-1"></i>
                                Chat Controls
                            </h6>
                            <div id="bot-responses-left" class="mb-2 text-muted small">
                                Bot responses: Loading...
                            </div>
                            <button class="btn btn-outline-primary btn-sm w-100" id="new-chat-btn">
                                <i class="fas fa-plus me-1"></i>
                                Start New Chat
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Chat Area -->
            <div class="col-md-9 col-lg-10 main-content">
                <!-- Header -->
                <header class="chat-header p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <h3 class="mb-1 text-white fw-bold">AI Medical Assistant</h3>
                                <div class="d-flex align-items-center">
                                    <div class="d-flex align-items-center me-4">
                                        <div class="status-indicator me-2" style="width: 8px; height: 8px; background: #20c997; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                        <small class="text-success fw-medium">Online & Ready</small>
                                    </div>
                                    <small class="text-muted">Symptom analysis â€¢ Medicine recommendations â€¢ Health guidance</small>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div id="chat-status" class="me-4">
                                <small class="text-muted">Ready to help with your health questions</small>
                            </div>
                            <div class="d-flex align-items-center me-3">
                                <i class="fas fa-shield-alt text-info me-2"></i>
                                <small class="text-info fw-medium">Secure & Private</small>
                            </div>
                            <div class="d-md-none">
                                <span class="badge bg-info" id="mobile-plan-badge">{{ user_plan.title() }}</span>
                            </div>
                        </div>
                    </div>
                </header>
                
                <!-- Chat Messages Container -->
                <div class="chat-container flex-grow-1">
                    <div id="chat-messages" class="h-100 p-3">
                        <!-- Welcome Message -->
                        <div class="message-container bot-message">
                            <div class="message-bubble">
                                <div class="message-content">
                                    <p><strong>Welcome to HealthAssist!</strong></p>
                                    <p>I'm your AI medical assistant. I can help identify common illnesses based on your symptoms and suggest over-the-counter medicines.</p>
                                    <p>Please describe your symptoms to get started. For example: "I have a headache and fever" or "I'm experiencing stomach pain and nausea".</p>
                                </div>
                                <small class="message-time text-muted">Just now</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <div class="chat-input-container p-4">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-text bg-transparent border-0" style="padding-left: 20px;">
                                    <i class="fas fa-stethoscope text-muted"></i>
                                </div>
                                <input type="text" class="form-control" id="chat-input" placeholder="Describe your symptoms... (e.g., 'I have a headache and fever')" disabled style="border-left: none; padding-left: 10px;">
                                {% if user_plan in ['pro', 'deluxe'] %}
                                <button class="btn btn-outline-danger" type="button" id="voice-button" disabled title="Voice input (Pro/Deluxe feature)">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                {% endif %}
                                <button class="btn btn-primary" type="button" id="send-button" disabled>
                                    <i class="fas fa-paper-plane me-1"></i>
                                    <span class="d-none d-sm-inline">Send</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div id="chat-status" class="text-start">
                                <small class="text-muted">Loading medical assistant...</small>
                            </div>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">
                                <i class="fas fa-lock me-1"></i>
                                Your health data is private and secure
                            </small>
                        </div>
                    </div>
                </div>
                

            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        class MedicalChatbot {
            constructor() {
                this.chatMessages = document.getElementById('chat-messages');
                this.chatInput = document.getElementById('chat-input');
                this.sendButton = document.getElementById('send-button');
                this.chatStatus = document.getElementById('chat-status');
                this.planSelector = document.getElementById('plan-selector');
                this.languageSelector = document.getElementById('language-selector');
                this.currentPlanBadge = document.getElementById('current-plan-badge');
                this.currentLanguageDisplay = document.getElementById('current-language-display');
                this.mobilePlanBadge = document.getElementById('mobile-plan-badge');
                this.newChatBtn = document.getElementById('new-chat-btn');
                this.botResponsesLeft = document.getElementById('bot-responses-left');
                this.voiceButton = document.getElementById('voice-button');
                
                // Voice chat properties
                this.isRecording = false;
                this.recognition = null;
                this.speechSynthesis = window.speechSynthesis;
                this.currentPlan = '{{ user_plan }}';
                this.userLanguage = '{{ user_language }}';
                this.voiceEnabled = ['pro', 'deluxe'].includes(this.currentPlan);
                
                this.isLoading = false;
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.loadUsageStats();
                this.enableChat();
            }
            
            bindEvents() {
                // Send message events
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                // Plan selection
                this.planSelector.addEventListener('change', (e) => {
                    this.switchPlan(e.target.value);
                });
                
                // Language selection
                this.languageSelector.addEventListener('change', (e) => {
                    this.switchLanguage(e.target.value);
                });
                
                // New chat button
                this.newChatBtn.addEventListener('click', () => {
                    this.startNewChat();
                });
                
                // Voice button
                if (this.voiceButton && this.voiceEnabled) {
                    this.voiceButton.addEventListener('click', () => {
                        this.toggleVoiceRecording();
                    });
                    this.initializeSpeechRecognition();
                }
            }
            
            enableChat() {
                this.chatInput.disabled = false;
                this.sendButton.disabled = false;
                this.chatStatus.innerHTML = '<small class="text-muted">Ready to chat</small>';
                this.chatInput.focus();
            }
            
            disableChat(message) {
                this.chatInput.disabled = true;
                this.sendButton.disabled = true;
                this.chatStatus.innerHTML = `<small class="text-warning">${message}</small>`;
            }
            
            async sendMessage() {
                const message = this.chatInput.value.trim();
                if (!message || this.isLoading) return;
                
                // Add user message to chat
                this.addMessage('user', message);
                this.chatInput.value = '';
                
                // Show loading state
                this.setLoading(true);
                
                try {
                    const response = await fetch('/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: message })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        this.addMessage('bot', data.message, data.medicines, data.disease);
                        this.loadUsageStats(); // Update usage stats
                        this.updateBotResponsesLeft(data.bot_responses_left);
                        
                        // Speak bot response if voice is enabled
                        if (this.voiceEnabled && data.message) {
                            // Remove markdown formatting for speech
                            const cleanText = data.message.replace(/\*\*(.*?)\*\*/g, '$1').replace(/\*(.*?)\*/g, '$1');
                            this.speakText(cleanText);
                        }
                        
                        // Check if bot response limit reached
                        if (data.limit_reached) {
                            this.disableChat('Bot response limit reached');
                            this.addMessage('bot', 'Bot response limit reached for this chat. Please start a new chat to continue.', null, null, 'warning');
                        }
                    } else {
                        if (response.status === 429) {
                            // Chat limit reached
                            this.addMessage('bot', data.error, null, null, 'error');
                            this.disableChat('Daily limit reached');
                        } else {
                            this.addMessage('bot', data.error || 'An error occurred', null, null, 'error');
                        }
                    }
                } catch (error) {
                    console.error('Error:', error);
                    this.addMessage('bot', 'Connection error. Please try again.', null, null, 'error');
                } finally {
                    this.setLoading(false);
                }
            }
            
            addMessage(type, content, medicines = null, disease = null, messageType = 'normal') {
                const messageContainer = document.createElement('div');
                messageContainer.className = `message-container ${type}-message`;
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `message-bubble ${messageType === 'error' ? 'error' : ''}`;
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                
                // Convert markdown-like formatting to HTML
                const formattedContent = this.formatMessage(content);
                messageContent.innerHTML = formattedContent;
                
                // Add medicine images if provided
                if (medicines && medicines.length > 0) {
                    const medicinesContainer = document.createElement('div');
                    medicinesContainer.className = 'medicines-container mt-3';
                    
                    medicines.forEach(medicine => {
                        const medicineItem = document.createElement('div');
                        medicineItem.className = 'medicine-item d-flex align-items-center mb-2';
                        
                        if (medicine.image) {
                            const img = document.createElement('img');
                            img.src = medicine.image;
                            img.alt = medicine.name;
                            img.className = 'medicine-image me-2';
                            img.style.width = '40px';
                            img.style.height = '40px';
                            img.style.objectFit = 'contain';
                            medicineItem.appendChild(img);
                        }
                        
                        const medicineInfo = document.createElement('div');
                        medicineInfo.className = 'medicine-info flex-grow-1';
                        
                        const medicineName = document.createElement('div');
                        medicineName.textContent = medicine.name;
                        medicineName.className = 'medicine-name fw-bold';
                        medicineInfo.appendChild(medicineName);
                        
                        // Add price for Pro and Deluxe plans
                        if (medicine.price) {
                            const medicinePrice = document.createElement('div');
                            medicinePrice.textContent = `Price: ${medicine.price}`;
                            medicinePrice.className = 'medicine-price text-success small';
                            medicineInfo.appendChild(medicinePrice);
                        }
                        
                        // Add buy link for Deluxe plan
                        if (medicine.buy_link) {
                            const buyLink = document.createElement('a');
                            buyLink.href = medicine.buy_link;
                            buyLink.textContent = 'Buy Online';
                            buyLink.className = 'btn btn-sm btn-outline-primary mt-1';
                            buyLink.target = '_blank';
                            buyLink.rel = 'noopener noreferrer';
                            medicineInfo.appendChild(buyLink);
                        }
                        
                        medicineItem.appendChild(medicineInfo);
                        medicinesContainer.appendChild(medicineItem);
                    });
                    
                    messageContent.appendChild(medicinesContainer);
                }
                
                const messageTime = document.createElement('small');
                messageTime.className = 'message-time text-muted';
                messageTime.textContent = new Date().toLocaleTimeString();
                
                messageBubble.appendChild(messageContent);
                messageBubble.appendChild(messageTime);
                messageContainer.appendChild(messageBubble);
                
                this.chatMessages.appendChild(messageContainer);
                this.scrollToBottom();
            }
            
            formatMessage(content) {
                return content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');
            }
            
            setLoading(loading) {
                this.isLoading = loading;
                this.sendButton.disabled = loading;
                this.chatInput.disabled = loading;
                
                if (loading) {
                    this.chatStatus.innerHTML = '<small class="text-info">AI is thinking...</small>';
                } else {
                    this.chatStatus.innerHTML = '<small class="text-muted">Ready to chat</small>';
                    this.chatInput.focus();
                }
            }
            
            scrollToBottom() {
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            async switchPlan(newPlan) {
                try {
                    const response = await fetch('/switch_plan', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ plan: newPlan })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.currentPlanBadge.textContent = data.new_plan.charAt(0).toUpperCase() + data.new_plan.slice(1);
                        if (this.mobilePlanBadge) {
                            this.mobilePlanBadge.textContent = data.new_plan.charAt(0).toUpperCase() + data.new_plan.slice(1);
                        }
                        this.loadUsageStats();
                        this.enableChat(); // Re-enable chat if it was disabled
                        
                        // Show plan switch notification
                        this.addMessage('bot', `Plan switched to ${data.new_plan.charAt(0).toUpperCase() + data.new_plan.slice(1)}! You can now enjoy the new features.`, null, null, 'info');
                        
                        // Reload page to update language options based on new plan
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                } catch (error) {
                    console.error('Error switching plan:', error);
                }
            }
            
            async switchLanguage(newLanguage) {
                try {
                    const response = await fetch('/switch_language', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ language: newLanguage })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Update current language display
                        const selectedOption = this.languageSelector.options[this.languageSelector.selectedIndex];
                        this.currentLanguageDisplay.textContent = selectedOption.textContent;
                        
                        // Show language switch notification
                        this.addMessage('bot', `Language switched to ${data.language_name}!`, null, null, 'info');
                        
                        // Reload page to apply new language
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    } else {
                        // Show error message
                        this.addMessage('bot', data.message || 'Language not available in your current plan', null, null, 'error');
                        
                        // Reset selector to current language
                        this.languageSelector.value = this.languageSelector.getAttribute('data-current');
                    }
                } catch (error) {
                    console.error('Error switching language:', error);
                    this.addMessage('bot', 'Error switching language. Please try again.', null, null, 'error');
                }
            }
            
            async startNewChat() {
                try {
                    this.setLoading(true);
                    const response = await fetch('/new_chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Clear current chat
                        this.chatMessages.innerHTML = '';
                        
                        // Add welcome message
                        this.addMessage('bot', data.message, null, null, 'info');
                        
                        // Re-enable chat
                        this.enableChat();
                        
                        // Update usage stats
                        this.loadUsageStats();
                        
                        // Reset bot responses counter
                        this.updateBotResponsesLeft(-1);
                        
                    } else {
                        this.addMessage('bot', data.error || 'Failed to start new chat', null, null, 'error');
                    }
                } catch (error) {
                    console.error('Error starting new chat:', error);
                    this.addMessage('bot', 'Connection error. Please try again.', null, null, 'error');
                } finally {
                    this.setLoading(false);
                }
            }
            
            updateBotResponsesLeft(count) {
                if (count === -1) {
                    this.botResponsesLeft.textContent = 'Bot responses: Unlimited';
                } else if (count === 0) {
                    this.botResponsesLeft.textContent = 'Bot responses: Limit reached';
                    this.botResponsesLeft.className = 'mb-2 text-danger small';
                } else {
                    this.botResponsesLeft.textContent = `Bot responses left: ${count}`;
                    this.botResponsesLeft.className = count <= 1 ? 'mb-2 text-warning small' : 'mb-2 text-muted small';
                }
            }
            
            initializeSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = this.getLanguageCode();
                    
                    this.recognition.onstart = () => {
                        this.isRecording = true;
                        this.voiceButton.innerHTML = '<i class="fas fa-stop"></i>';
                        this.voiceButton.classList.remove('btn-outline-danger');
                        this.voiceButton.classList.add('btn-danger');
                        this.voiceButton.title = 'Stop recording';
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.chatInput.value = transcript;
                        this.chatInput.focus();
                    };
                    
                    this.recognition.onend = () => {
                        this.isRecording = false;
                        this.voiceButton.innerHTML = '<i class="fas fa-microphone"></i>';
                        this.voiceButton.classList.remove('btn-danger');
                        this.voiceButton.classList.add('btn-outline-danger');
                        this.voiceButton.title = 'Voice input';
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.isRecording = false;
                        this.voiceButton.innerHTML = '<i class="fas fa-microphone"></i>';
                        this.voiceButton.classList.remove('btn-danger');
                        this.voiceButton.classList.add('btn-outline-danger');
                        this.voiceButton.title = 'Voice input';
                        
                        if (event.error === 'not-allowed') {
                            this.addMessage('bot', 'Microphone access denied. Please allow microphone access to use voice input.', null, null, 'warning');
                        }
                    };
                } else {
                    this.voiceButton.disabled = true;
                    this.voiceButton.title = 'Speech recognition not supported in this browser';
                }
            }
            
            toggleVoiceRecording() {
                if (!this.voiceEnabled) {
                    this.addMessage('bot', 'Voice chat is only available for Pro and Deluxe plan subscribers. Please upgrade your plan to use this feature.', null, null, 'warning');
                    return;
                }
                
                if (this.isRecording) {
                    this.recognition.stop();
                } else {
                    this.recognition.start();
                }
            }
            
            getLanguageCode() {
                const languageMap = {
                    'en': 'en-US',
                    'hi': 'hi-IN',
                    'es': 'es-ES',
                    'fr': 'fr-FR',
                    'de': 'de-DE',
                    'it': 'it-IT',
                    'pt': 'pt-PT',
                    'ru': 'ru-RU',
                    'ja': 'ja-JP',
                    'ko': 'ko-KR',
                    'zh': 'zh-CN',
                    'ar': 'ar-SA'
                };
                return languageMap[this.userLanguage] || 'en-US';
            }
            
            speakText(text) {
                if (!this.voiceEnabled || !this.speechSynthesis) return;
                
                // Cancel any ongoing speech
                this.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = this.getLanguageCode();
                utterance.rate = 0.9;
                utterance.pitch = 1;
                
                // Try to find a voice for the current language
                const voices = this.speechSynthesis.getVoices();
                const voice = voices.find(v => v.lang.startsWith(this.userLanguage)) || 
                             voices.find(v => v.lang.startsWith('en'));
                if (voice) {
                    utterance.voice = voice;
                }
                
                this.speechSynthesis.speak(utterance);
            }
            
            async loadUsageStats() {
                try {
                    const response = await fetch('/usage_stats');
                    const data = await response.json();
                    
                    document.getElementById('usage-count').textContent = data.current_usage;
                    document.getElementById('usage-limit').textContent = 
                        data.max_chats === 999 ? 'âˆž' : data.max_chats;
                    
                    // Check if limit is reached
                    if (data.remaining === 0) {
                        this.disableChat('Daily limit reached');
                    }
                } catch (error) {
                    console.error('Error loading usage stats:', error);
                }
            }
        }
        
        // Initialize chatbot when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MedicalChatbot();
        });
    </script>
</body>
</html>
